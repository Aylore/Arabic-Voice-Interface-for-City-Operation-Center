<!DOCTYPE html>
<fieldset>
    <legend>Arabic-Voice-Interface-for-City-Operation-Center</legend>

    <head>
        <title>Arabic Dialect Classification</title>
        <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    </head>

    <body>

        <h1>Speech-to-Text Transcription</h1>

        <form action="{% url 'transcribe' %}" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <label for="audio">Upload Audio:</label>
            <input type="file" name="audio" id="audio" accept="audio/*" required><br>
            <input type="submit" value="Transcribe">
        </form>

        <textarea>{{ transcript }}</textarea>

    </body>

</fieldset>

<!DOCTYPE html>
<fieldset>
    <legend>Arabic-Voice-Interface-for-City-Operation-Center</legend>

    <head>
        <title>Arabic-Voice-Interface-for-City-Operation-Center</title>
        <link rel="stylesheet" href="{% static 'google_app/styles.css' %}">
    </head>

    <body>
        <!DOCTYPE html>
        <html>

        <head>
            <title>Speech to Text</title>
        </head>

        <body>
            <h1>Speech to Text</h1>
            <textarea id="transcription-textarea" rows="10" cols="50"></textarea>
            <br>
            <button id="record-button">Start Recording</button>

            <script>
                const recordButton = document.getElementById('record-button');
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();

                recordButton.addEventListener('click', () => {
                    recognition.start();
                });

                recognition.addEventListener('result', (event) => {
                    const audioData = event.results[0][0].transcript;

                    // Send the audio data to the server using an AJAX request
                    const xhr = new XMLHttpRequest();
                    xhr.open('POST', '/');
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    xhr.onload = function () {
                        if (xhr.status === 200) {
                            const response = JSON.parse(xhr.responseText);
                            const transcriptionTextArea = document.getElementById('transcription-textarea');
                            transcriptionTextArea.value += response.transcription + '\n';
                        }
                    };
                    xhr.send(JSON.stringify({ audio_data: audioData }));
                });
            </script>
            <!-- <div id="transcription-container"></div>
            <script>
                const transcriptionContainer = document.getElementById('transcription-container');
                const eventSource = new EventSource('/');

                eventSource.addEventListener('message', (event) => {
                    const data = event.data;
                    const newTranscriptionElement = document.createElement('p');
                    newTranscriptionElement.innerText = data;
                    transcriptionContainer.appendChild(newTranscriptionElement);
                });
            </script> -->
            <!-- <textarea id="transcription-textarea" rows="10" cols="50"></textarea> -->
            
            <!-- <script>
                const transcriptionTextArea = document.getElementById('transcription-textarea');
                const xhr = new XMLHttpRequest();
                xhr.open('GET', '/');
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 3 && xhr.status == 200) {
                        const response = xhr.responseText;
                        transcriptionTextArea.value += response;
                    }
                };
                xhr.send();
            </script> -->
            <!-- <button id="record-button">Start Recording</button>
        <script> 
            const recordButton = document.getElementById('record-button'); 
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition; 
            const recognition = new SpeechRecognition(); 
            recordButton.addEventListener('click', () => { recognition.start(); }); 
            recognition.addEventListener('result', (event) => { const audioData = event.results[0][0].transcript; 
            const xhr = new XMLHttpRequest(); 
            xhr.open('POST', '/transcribe-audio/'); 
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded'); 
            xhr.onload = function () { if (xhr.status === 200) { const response = JSON.parse(xhr.responseText); console.log(response.transcription); } }; 
            xhr.send(encodeURI(`audio_data=${audioData}`)); }); 
        </script> -->

            <h1>Speech-to-Text Transcription</h1>
            <button id="record-btn">Record</button>
            <button id="stop-btn" disabled>Stop</button>
            <button id="play-btn" disabled>Play</button>
            <audio id="audio" controls></audio>
            <form action="{% url 'transcribe' %}" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <label for="audio">Upload Audio:</label>
                <input type="file" name="audio" id="audio" accept="audio/*" required><br>
                <input type="submit" value="Transcribe">
            </form>
            <textarea>{{ transcript }}</textarea>

        </body>

</fieldset>